"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[4281],{74281:(e,r,t)=>{t.r(r),t.d(r,{PurchaseEventName:()=>A,StoreKitSubProvider:()=>y});var a=t(89338),n=t(2827),u=t.n(n),i=t(22155),s=t(14243),o=t(9487),l=t(20573),c=t(63815),d=t(80244),p=t(62424),b=t(55551),h=t(68390),f=t(16354),v=t(54883),P=t(68392),m=t(92315),g=t(57952),k=t(36899),I=t(49556),C=i.createElement,A=function(e){return e.PurchaseCompleted="PurchaseCompleted",e.PurchaseInitiated="PurchaseInitiated",e.PurchasePending="PurchasePending",e.PurchaseFailed="PurchaseFailed",e.PurchaseError="PurchaseError",e.PurchaseCancelled="PurchaseCancelled",e}({}),y=function(e){var r,t=e.children,n=e.successCallback,y=(0,o.useRouter)(),T=(0,P.mu)().displayToast,S=(0,d.Z2)(),w=S.user,x=S.isValidRegion,E=(0,m.L)().logSubscriptionEvent,N=(0,p.VQ)().growthbook,B=(0,p.iT)(b.XP),F=(0,i.useMemo)((function(){return Object.keys(B)}),[B]),q=(0,i.useRef)();q.current=E;var L,O=(0,s.I)({queryKey:["iap-products"],enabled:!!B&&!(null==N||!N.ready)&&(0,c.B6)(),queryFn:(L=(0,a.A)(u().mark((function e(){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,c.QD)(c.NB.IAPSubscriptionRequest)){e.next=2;break}return e.abrupt("return",[]);case 2:return r=(0,h.HD)("iap-products-result",(function(e){var r=(0,h.hX)(null==e?void 0:e.detail)?[]:e.detail,t="string"==typeof r?JSON.parse(r):r;return null==t?void 0:t.map((function(e){var r=B[e.attributes.offerName],t=r.duration,a=r.label,n=r.extraLabel,u=r.appsId;return{label:a,value:e.attributes.offerName,price:{amount:parseFloat(e.attributes.offers[0].price),formatted:e.attributes.offers[0].priceFormatted},extraLabel:n,appsId:null!=u?u:f.lL.Default,duration:t,durationLabel:t===f.qf.Yearly?"year":"month",trialPeriod:null}})).sort((function(e,r){return F.indexOf(e.value)-F.indexOf(r.value)}))})),(0,c.Ks)(c.NB.IAPProductList,F),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),function(){return L.apply(this,arguments)})}),R=O.data,K=(0,i.useCallback)((function(e){var r,t=e.priceId;(0,c.Ks)(c.NB.IAPSubscriptionRequest,{productId:t,appAccountToken:null==w||null===(r=w.subscriptionFlags)||void 0===r?void 0:r.appAccountToken})}),[null==w||null===(r=w.subscriptionFlags)||void 0===r?void 0:r.appAccountToken]);(0,i.useEffect)((function(){var e="iap-purchase-event";return(0,h.HD)(e,(function(e){var r=e.detail,t=r.name,a=r.detail,u=r.product;switch(t){case A.PurchaseCompleted:q.current({event_name:g.VB.CompleteCheckout,extra:{user_id:null==w?void 0:w.id,cycle:B[u.attributes.offerName].duration,localCost:u.attributes.offers[0].price,localCurrency:u.attributes.offers[0].currencyCode,payment:I.d.AppleStoreKit}}),n?n():y.push(v.j$);break;case A.PurchaseInitiated:q.current({event_name:g.VB.InitiatePayment});break;case A.PurchaseFailed:q.current({event_name:g.VB.ErrorCheckout,extra:{errorCode:a}}),T(k.XW);break;case A.PurchasePending:T("Please wait for the purchase to be completed.");case A.PurchaseCancelled:}}),{once:!1}),function(){var r;null===globalThis||void 0===globalThis||null===(r=globalThis.eventControllers)||void 0===r||null===(r=r[e])||void 0===r||r.abort()}}),[T,B,y,n,null==w?void 0:w.id]);var M=(0,i.useMemo)((function(){return{openCheckout:K,productOptions:R,earlyAdopterPlanId:null,isPlusAvailable:x,giftOneYear:void 0,isPricesPending:!1,isFreeTrialExperiment:!1}}),[x,K,R]);return C(l.Q.Provider,{value:M},t)}},63815:(e,r,t)=>{t.d(r,{B6:()=>i,Ks:()=>s,NB:()=>n,QD:()=>u});var a=t(68390),n=function(e){return e.NativeAuth="native-auth",e.UpdateUserId="update-user-id",e.TrackEvent="track-event",e.PushState="push-state",e.PushUserId="push-user-id",e.PushSubscribe="push-subscribe",e.PushUnsubscribe="push-unsubscribe",e.IAPProductList="iap-product-list",e.IAPSubscriptionManage="iap-subscription-manage",e.IAPSubscriptionRequest="iap-subscription-request",e.IAPSetAppAccountToken="iap-set-app-account-token",e}({}),u=function(e){var r;return(0,a.Ji)()&&!(null===globalThis||void 0===globalThis||null===(r=globalThis.webkit)||void 0===r||null===(r=r.messageHandlers)||void 0===r||!r[e])},i=function(){return(0,a.Ji)()&&u(n.IAPSubscriptionRequest)},s=function(e,r){if(!(0,a.Ji)())throw new Error("sendMessage is only available on iOS");if(!u(e))throw new Error("Message handler ".concat(e," does not exist"));globalThis.webkit.messageHandlers[e].postMessage(r)}}}]);