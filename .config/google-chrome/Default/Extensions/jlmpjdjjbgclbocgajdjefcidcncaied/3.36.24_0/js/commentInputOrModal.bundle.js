"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[2408],{98474:(e,n,t)=>{t.r(n),t.d(n,{default:()=>W});var o=t(7527),r=t(75087),i=t(22155),u=t(50122),l=t(30395),a=t.n(l),s=t(66007),c=t(24481),d=t(17398),m=(0,i.createContext)({mutateComment:null}),f=i.createElement;function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){(0,u.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function h(e,n){var t,r=e.post,u=e.initialContent,l=e.replyTo,p=e.editCommentId,h=e.className,b=void 0===h?{}:h,y=e.style,g=e.onChange,C=e.showSubmit,w=void 0===C||C,O=e.showUserAvatar,x=void 0===O||O,j=e.formProps,P=void 0===j?{}:j,S=e.onClose,A=null==r?void 0:r.id,I=null==r||null===(t=r.source)||void 0===t?void 0:t.id,k=(0,i.useRef)(),N=(0,i.useContext)(m).mutateComment,E=N.mutateComment,T=N.isLoading,D=N.isSuccess;return(0,i.useEffect)((function(){var e;null==k||null===(e=k.current)||void 0===e||null===(e=e.textareaRef)||void 0===e||null===(e=e.current)||void 0===e||e.focus()}),[]),f("form",(0,o.A)({},P,{action:"#",onSubmit:function(e){if(e.preventDefault(),T||D)return null;var n=(0,d.Y)(e.currentTarget).content;return E(n)},className:null==b?void 0:b.container,style:y,ref:n}),f(c.A,{ref:k,className:{tab:a()("!min-h-16",null==b?void 0:b.tab),input:a()(null==b?void 0:b.input,l&&"mt-0"),profile:l&&"!mt-0",container:null==b?void 0:b.markdownContainer},postId:A,sourceId:I,showUserAvatar:x,isLoading:T,disabledSubmit:D,initialContent:u,textareaProps:{name:"content",rows:7,placeholder:"Share your thoughts"},onSubmit:function(e){if(T||D)return null;var n=e.currentTarget.value;return E(n)},enabledCommand:v(v({},s.RS),{},{upload:!0}),submitCopy:w&&(p?"Update":"Comment"),timeline:l?f("span",{className:"py-2 pl-12 text-text-tertiary typo-caption1"},"Reply to",f("span",{className:"ml-2 font-bold text-text-primary"},l)):null,onValueUpdate:g,onClose:S}))}var b=(0,i.forwardRef)(h),y=t(72870),g=t(89338),C=t(2827),w=t.n(C),O=t(69918),x=t(94198),j=t(15751),P=t(92203),S=t(5947),A=t(99604),I=t(57952),k=t(11924),N=t(30530),E=t(51722),T=t(61663),D=t(91201),R=t(80244);function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function M(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,u.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var U=function(e){var n,t=e.post,o=e.editCommentId,r=e.parentCommentId,u=e.onCommented,l=null==t||null===(n=t.source)||void 0===n?void 0:n.id,a=null==t?void 0:t.id,s=null!=r?r:a,c=(0,R.Z2)().user,d=(0,O.jE)(),m=(0,D.D)(),f=m.requestMethod,p=m.isCompanion,v=(0,T.DX)().logEvent,h=(0,i.useMemo)((function(){return N.$h.apply(void 0,[N.jZ.PostCommentsMutations,c].concat((0,P.A)([a,l,o,r].filter((function(e){return!!e})))))}),[c,a,l,o,r]),b=function(e){if(e){var n=function(n){if(!n)return n;var t=structuredClone(n);if(!o){var i=function(e){return{node:M(M({},e),{},{children:{edges:[],pageInfo:null}})}}(e);if(!r)return t.postComments.edges.unshift(i),t;var u=t.postComments.edges.findIndex((function(e){return e.node.id===r}));return t.postComments.edges[u].node.children.edges.push(i),t}if(!r){var l=t.postComments.edges.findIndex((function(e){return e.node.id===o}));return t.postComments.edges[l].node=M(M({},e),{},{children:t.postComments.edges[l].node.children}),t}var a=t.postComments.edges.find((function(e){return e.node.id===r})),s=a.node.children.edges.findIndex((function(e){return e.node.id===o}));return a.node.children.edges[s].node=M(M({},e),{},{children:a.node.children}),t},i=[];(0,N.w$)(a).forEach((function(e){d.setQueryData(e,(function(t){return t?n(t):(i.push(e),null)}))})),i.forEach(function(){var e=(0,g.A)(w().mark((function e(n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.invalidateQueries({queryKey:n});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),o||((0,N.kh)(d,a,{numComments:t.numComments+1}),v((0,k.P5)(I.VB.CommentPost,t,{extra:{commentId:r}}))),u&&u(e,!o,r)}},y=r?A.Uk:A.Fe,C=(0,S.n)({mutationFn:function(e){return f(y,e,{requestKey:JSON.stringify(h)})},onSuccess:function(e){return b(null==e?void 0:e.comment)}}),x=C.mutateAsync,j=C.isPending,q=C.isSuccess;(0,E.X)(h,{enabled:p,callback:function(e){var n=e.res;return b(null==n?void 0:n.comment)}});var U=(0,S.n)({mutationFn:function(e){return f(A.fK,e,{requestKey:JSON.stringify(h)})},onSuccess:function(e){return b(null==e?void 0:e.comment)}}),F=U.mutateAsync,$=U.isPending;return{mutateComment:(0,i.useCallback)((function(e){return o?F({id:o,content:e}):x({content:e,id:s})}),[o,s,F,x]),isLoading:j||$,isSuccess:q}},F=t(4004),$=function(){var e,n,t,o;return{width:null!==(e=null===globalThis||void 0===globalThis||null===(n=globalThis.window)||void 0===n||null===(n=n.visualViewport)||void 0===n?void 0:n.width)&&void 0!==e?e:0,height:null!==(t=null===globalThis||void 0===globalThis||null===(o=globalThis.window)||void 0===o||null===(o=o.visualViewport)||void 0===o?void 0:o.height)&&void 0!==t?t:0}},H=function(){var e,n=(0,i.useState)($),t=n[0],o=n[1];return(0,F.M)(null===globalThis||void 0===globalThis||null===(e=globalThis.window)||void 0===e?void 0:e.visualViewport,"resize",(function(){return o($)})),t},L=t(57434),V=t(68334),B=t(91480),K=t(86242),Q=i.createElement;function Z(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return _(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return u=e.done,e},e:function(e){l=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(l)throw i}}}}function _(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}var z=function(e,n){var t,o;if(null!=e&&null!==(t=e.postComments)&&void 0!==t&&t.edges){var r,i=Z(null==e||null===(o=e.postComments)||void 0===o?void 0:o.edges);try{for(i.s();!(r=i.n()).done;){var u=r.value;if(u.node.id===n)return u.node;if(u.node.children){var l,a=Z(u.node.children.edges);try{for(a.s();!(l=a.n()).done;){var s=l.value;if(s.node.id===n)return s.node}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){i.e(e)}finally{i.f()}}},J=function(e){var n=e.client,t=e.postId,o=e.commentId;if(o){var r,i=Z((0,N.w$)(t));try{for(i.s();!(r=i.n()).done;){var u=r.value,l=z(n.getQueryData(u),o);if(l)return l}}catch(e){i.e(e)}finally{i.f()}}};function X(e){var n,t,o,r,u,l,s,c,d,f,p=e.isOpen,v=e.onRequestClose,h=e.onAfterClose,y=e.onCommented,C=e.parentCommentId,P=e.replyToCommentId,S=e.editCommentId,A=e.post,k=(0,i.useRef)(null),N=(0,i.useRef)(null),E=(0,i.useRef)(null),T=(0,i.useRef)(null),D=(0,R.Z2)().user,q=(0,O.jE)(),M=(0,i.useState)(null),F=M[0],$=M[1],Z=!!S,_=!Z&&!!P,z=(0,K.A)({id:S,options:{enabled:!!S}}).comment,X=(0,i.useCallback)((function(e){e&&$(e)}),[$]),Y=(0,L.$)({source:I.vH.NewComment}),G=Y.shouldShowCta,W=Y.isEnabled,ee=Y.onToggle,ne=Y.onSubmitted,te=(0,i.useMemo)((function(){return J({client:q,postId:null==A?void 0:A.id,commentId:Z?S:null!=P?P:C})}),[q,null==A?void 0:A.id,Z,S,C,P]),oe=U({post:A,editCommentId:Z&&S,parentCommentId:C,onCommented:function(e,n,t){y&&y(e,n,t),v()}}),re=oe.isLoading,ie=oe.isSuccess;(0,i.useLayoutEffect)((function(){var e;null==F||null===(e=F.scrollTo)||void 0===e||e.call(F,{behavior:"auto",top:1e4})}),[F]);var ue=H().height,le=null!==(n=null===(t=E.current)||void 0===t?void 0:t.clientHeight)&&void 0!==n?n:0,ae=null!==(o=null===(r=T.current)||void 0===r?void 0:r.clientHeight)&&void 0!==o?o:0,se=ue-(null!==(u=null===(l=N.current)||void 0===l?void 0:l.offsetHeight)&&void 0!==u?u:0)-le-ae,ce=se>0?Math.max(se,300):"auto";k.current&&(null===(s=k.current.style)||void 0===s?void 0:s.height)!=="".concat(ce,"px")&&(k.current.style.height="".concat(ce,"px"));var de,me=(0,i.useMemo)((function(){return Z?{submitCopy:"Save",initialContent:null==z?void 0:z.content}:_?{submitCopy:"Reply",initialContent:null!=te&&null!==(e=te.author)&&void 0!==e&&e.id&&te.author.id!==(null==D?void 0:D.id)?"@".concat(null==te||null===(n=te.author)||void 0===n?void 0:n.username," "):void 0}:{submitCopy:"Comment"};var e,n}),[Z,_,te,z,null==D?void 0:D.id]),fe=me.submitCopy,pe=me.initialContent;return Q(x.aF,{isOpen:p,onRequestClose:v,onAfterClose:h,className:"!border-none",overlayClassName:"!touch-none"},Q(x.aF.Body,{className:"!p-0",ref:X},Q(m.Provider,{value:{mutateComment:oe}},Q(j._,{form:"write-comment",copy:{right:fe},leftButtonProps:{onClick:v},rightButtonProps:{onClick:(de=(0,g.A)(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne();case 2:case"end":return e.stop()}}),e)}))),function(){return de.apply(this,arguments)}),loading:re,disabled:ie},className:{container:"flex-1 first:!border-none",header:"sticky top-0 z-2 w-full bg-background-default"},headerRef:N},_&&te&&Q(i.Fragment,null,Q(B.A,{post:A,comment:te,className:{container:"mx-4 mt-4 border"},postAuthorId:null==A||null===(c=A.author)||void 0===c?void 0:c.id,postScoutId:null==A||null===(d=A.scout)||void 0===d?void 0:d.id}),Q("div",{className:"ml-12 flex gap-2 border-l border-border-subtlest-tertiary py-3 pl-5 text-text-tertiary typo-caption1",ref:E},"Reply to",Q("span",{className:"font-bold text-text-primary"},null===(f=te.author)||void 0===f?void 0:f.username))),Q(b,{ref:k,replyTo:null,post:A,parentCommentId:C,editCommentId:Z&&S,initialContent:pe,className:{markdownContainer:"flex-1",container:a()("flex flex-col",_?"h-[calc(100%-2.5rem)]":"h-full"),tab:"flex-1",input:"comment-input-123 !max-h-none flex-1"},showSubmit:!1,showUserAvatar:!1,formProps:{id:"write-comment"}}),G&&Q(V.d,{inputId:"push_notification-switch",name:"push_notification",labelClassName:"flex-1 font-normal",className:"px-3 py-3.5",compact:!1,checked:W,onToggle:ee,ref:T},"Receive updates when other members engage")))))}var Y=["onClose","className"],G=i.createElement;function W(e){var n=e.onClose,t=e.className,i=(0,r.A)(e,Y),u=!(0,y.G6)(y.bh.Tablet),l=U({post:i.post,editCommentId:i.editCommentId,parentCommentId:i.parentCommentId,onCommented:i.onCommented});return u?G(X,(0,o.A)({},i,{isOpen:!0,onRequestClose:n})):G(m.Provider,{value:{mutateComment:l}},G(b,(0,o.A)({},i,{className:t.input,onClose:n})))}},57434:(e,n,t)=>{t.d(n,{$:()=>s});var o=t(89338),r=t(2827),i=t.n(r),u=t(22155),l=t(57952),a=t(35393),s=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).source,n=void 0===e?l.vH.SquadPostCommentary:e,t=(0,u.useState)(!0),r=t[0],s=t[1],c=(0,a.W)({source:n}),d=c.shouldShowCta,m=c.onEnable,f=c.onDismiss,p=function(){var e=(0,o.A)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return");case 2:return n=r?m:f,e.next=5,n();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=(0,u.useCallback)((function(){return s((function(e){return!e}))}),[]);return{isEnabled:r,onToggle:v,shouldShowCta:d,onSubmitted:p}}},17398:(e,n,t)=>{t.d(n,{Y:()=>u});var o=t(50122);function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){(0,o.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){return Array.from(e.elements).reduce((function(e,n){return""===n.name?e:"checkbox"===n.type?i(i({},e),{},(0,o.A)({},n.name,n.checked)):"radio"!==n.type||n.checked?"file"===n.type?i(i({},e),{},(0,o.A)({},n.name,0===n.files.length?null:n.files)):i(i({},e),{},(0,o.A)({},n.name,n.value.length?n.value:null)):e}),n)}}}]);